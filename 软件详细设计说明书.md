# 软件详细设计说明书

> 《软件详细设计说明书》是对《软件概要设计说明书》的补充。
>
> 1. 本课程及本实验不涉及、不强调、不关注的部分可省略，但不允许删除已有条目。
> 2. 最终文档请删除所有灰色字体和斜体等说明部分。

[TOC]

## 1 引言

本文档旨在详细说明视频网站软件系统的设计，包括其架构、模块、接口以及与之交互的外部系统。本文档的目的是为项目团队提供指导，确保软件开发的一致性和完整性，并为未来的维护和升级提供参考。

### 1.1 编写目的

本设计文档的编写目的是为了指导和记录视频网站软件系统的详细设计过程。本文档主要面向项目开发团队，包括架构师、开发人员、测试人员和项目管理人员，同时也可供项目相关的其他利益相关者参考。

### 1.2 背景

a．待开发软件系统的名称；BiliMili在线视频分享平台

b．本项目由需求方《软件工程基础》课程组提出，预计由郑慕涵，高铭，彭欣阳，何家天，王元共同开发，面向所有人使用。条件允许可以架设服务器。

### 1.3 术语表

- **视频网站（Video Website）**：一个提供视频内容展示和分享的在线平台。
- **用户（User）**：注册并使用视频网站软件系统的个人或团体。
- **CMS（Content Management System）**：内容管理系统，用于管理网站内容的软件应用程序。
- **CDN（Content Delivery Network）**：内容分发网络，一种通过互联网内容分发服务加速用户获取数据和内容的系统。

### 1.4 参考文档

- BiliMili网站软件系统需求规格说明书
- BiliMili网站软件系统概要设计文档
- 相关技术标准和协议文档

## 2 系统结构设计及子系统划分

在本节中，我们将详细介绍视频网站软件系统的组成部分及其逻辑结构，并对各个子系统进行划分。每个子系统都将通过活动图和顺序图来说明其工作流程和交互关系。

### 2.1 登录注册子系统

**登录注册子系统**负责处理用户的注册和登录过程，确保用户能够安全地访问其个人账户。

#### 活动图
- 用户访问登录页面。
- 用户输入用户名和密码。
- 系统验证用户凭证。
- 成功登录后，用户被重定向到主页。
![](/Users/zhengmuhan/Desktop/大二下/软件工程/Report/img/WechatIMG302.jpg)

#### 顺序图
1. 用户发起登录请求。
2. 系统请求用户输入凭证。
3. 用户提交凭证。
4. 系统验证凭证。
5. 系统返回登录结果。
![](/Users/zhengmuhan/Desktop/大二下/软件工程/Report/img/WechatIMG303.jpg)

### 2.2 视频上传子系统

**视频上传子系统**允许用户上传视频。

#### 活动图

- **初始化：**系统启动并加载视频处理模块。
- **用户验证：**用户登录以访问视频功能。
- **视频上传：**用户上传视频文件至系统。
- **格式检查：**系统检查视频格式是否符合要求。
- **视频处理：**
    - 如果格式正确，进入下一步；
    - 如果格式不正确，提示用户并请求重新上传。
- **视频转码：**系统对视频进行转码以适应不同的播放需求。
- **视频存储：**转码后的视频被存储在服务器上。
- **完成处理：**视频处理完成，用户可以进行观看或分享。
![](/Users/zhengmuhan/Desktop/大二下/软件工程/Report/img/WechatIMG304.jpg)

#### 顺序图

1. 用户：发起视频上传请求。
2. 系统：验证用户身份。
3. 系统：接收视频文件。
4. 系统：检查视频格式。
5. 系统：
    - 如果视频格式正确，进行转码；
    - 如果视频格式不正确，返回错误消息。
6. 系统：存储转码后的视频。
7. 用户：接收处理完成的通知。
![](/Users/zhengmuhan/Desktop/大二下/软件工程/Report/img/WechatIMG305.jpg)

## 3 功能模块设计



#### 3.1 用户管理模块

> **模块编号：M2**
> **模块名称：用户管理模块**
>
> **输入：**
> 1. 用户注册信息（用户名、密码、邮箱等）
> 2. 用户登录信息（用户名、密码）
> 3. 用户个人资料修改信息（新用户名、新密码、新邮箱等）
> 4. 当前用户信息（用于权限验证）
>
> **处理：**
> 1. 处理用户注册请求，验证注册信息的合法性，包括用户名是否唯一、密码强度是否符合要求等。
> 2. 处理用户登录请求，验证登录信息的正确性，包括用户名和密码是否匹配。
> 3. 处理用户个人资料修改请求，验证修改信息的合法性，包括新用户名是否唯一、密码强度是否符合要求等。
> 4. 根据当前用户信息进行权限验证，确保用户有权进行相应的操作。
>
> **算法描述：**
> 1. 接收到用户注册请求后，从注册信息中提取用户名、密码等，并进行验证。
> 2. 如果验证通过，将用户信息存储到数据库中，并生成用户唯一的ID。
> 3. 接收到用户登录请求后，从登录信息中提取用户名、密码等，并进行验证。
> 4. 如果验证通过，根据用户名从数据库中查询用户信息，并返回登录成功的提示信息。
> 5. 接收到用户个人资料修改请求后，从修改信息中提取新用户名、新密码等，并进行验证。
> 6. 如果验证通过，更新数据库中对应用户的信息。
> 7. 对于其他需要权限验证的操作，根据当前用户信息进行权限验证，并返回相应的结果。
>
> **输出：**
> 1. 用户注册成功的提示信息。
> 2. 用户登录成功的提示信息。
> 3. 用户个人资料修改成功的提示信息。
> 4. 操作结果（成功或失败）。
>
> 用户管理模块应该与其他模块尽可能地解耦合，以确保模块的独立性和可维护性。例如，用户管理模块应该专注于处理用户注册、登录和个人资料修改等功能，而不需要过多涉及视频上传或评论功能。



#### 3.2 视频上传及管理模块

> **模块编号：m2**
>
> **输入：**
>
> 1. 视频文件（包括视频文件和封面图）
> 2. 视频信息（标题、描述、标签等）
> 3. 当前用户信息（用于权限验证）
>
> **处理：**
>
> 1. 接收上传的视频文件和视频信息。
> 2. 对上传的视频进行存储，并生成一个唯一的视频ID。
> 3. 将视频信息与视频ID关联，并存储到数据库中。
> 4. 根据当前用户信息进行权限验证，确保用户有权上传视频。
>
> **算法描述：**
>
> 1. 接收到上传请求后，服务器将视频文件保存到指定的存储位置。
> 2. 生成视频ID，并将视频信息与视频ID关联。
> 3. 将视频信息存储到数据库中，包括标题、描述、标签等。
> 4. 对上传的视频进行审核，确保符合网站规定的格式和内容要求。
>
> **输出：**
>
> 1. 视频上传成功的提示信息。
> 2. 视频信息的存储结果（成功或失败）。
>
> 在设计中，视频上传模块应该与其他模块尽可能地解耦合，以确保模块的独立性和可维护性。例如，视频上传模块应该专注于处理视频上传和存储的功能，而不需要过多涉及用户信息管理或视频播放等其他功能。



#### 3.3 用户交互模块

> **模块编号：m3**
>
> **输入：**
>
> 1. 视频ID（用于获取视频信息和播放视频）
> 2. 用户评论信息（评论内容、回复对象等）
> 3. 用户点赞和收藏操作信息（视频ID、用户ID）
> 4. 当前用户信息（用于权限验证）
>
> **处理：**
>
> 1. 处理用户观看视频请求，根据视频ID获取视频信息并播放视频。
> 2. 处理用户评论请求，将评论内容和相关信息存储到数据库中。
> 3. 处理用户点赞和收藏操作，更新对应视频的点赞和收藏数。
> 4. 根据当前用户信息进行权限验证，确保用户有权进行相应的操作。
>
> **算法描述：**
>
> 1. 接收到用户观看视频请求后，根据视频ID从数据库中获取视频信息，并返回给用户。
> 2. 接收到用户评论请求后，将评论内容和相关信息（如视频ID、用户ID等）存储到数据库中，并返回评论成功的提示信息。
> 3. 接收到用户点赞和收藏操作后，根据视频ID更新数据库中对应视频的点赞和收藏数，并返回操作成功的提示信息。
> 4. 对于其他需要权限验证的操作，根据当前用户信息进行权限验证，并返回相应的结果。
>
> **输出：**
>
> 1. 视频信息（包括标题、描述、标签等）以及视频播放页面。
> 2. 用户评论成功的提示信息。
> 3. 用户点赞和收藏操作成功的提示信息。
> 4. 操作结果（成功或失败）。
>
> 用户交互模块应该与其他模块尽可能地解耦合，以确保模块的独立性和可维护性。例如，用户交互模块应该专注于处理用户观看视频、评论、点赞和收藏等功能，而不需要过多涉及用户管理或视频上传等其他功能。



#### 3.4 内容推荐模块

> **模块编号：m4**
>
> **输入：**
> 1. 用户ID（用于获取用户的兴趣爱好）
> 2. 当前视频ID（用于获取当前视频的标签信息）
> 3. 视频信息（标题、描述、标签等）
> 4. 系统中所有视频信息（用于推荐热门视频）
>
> **处理：**
> 1. 根据用户的兴趣爱好和历史观看记录，推荐相关的视频。
> 2. 根据当前视频的标签信息，推荐相关的视频。
> 3. 根据系统中所有视频的播放量和点赞数等指标，推荐热门视频。
> 4. 对推荐结果进行排序和过滤，确保推荐的视频质量和多样性。
>
> **算法描述：**
> 1. 根据用户的兴趣爱好和历史观看记录，计算用户的偏好，并从系统中筛选出相关的视频。
> 2. 根据当前视频的标签信息，从系统中筛选出具有相似标签的视频。
> 3. 根据系统中所有视频的播放量和点赞数等指标，计算每个视频的热度，并选择热门视频进行推荐。
> 4. 对推荐结果进行排序，以用户的偏好和热度作为排序依据，并根据用户的观看历史和喜好过滤推荐结果，确保推荐的视频符合用户的兴趣和口味。
>
> **输出：**
> 1. 推荐给用户的视频列表，包括标题、描述、标签等信息。
> 2. 热门视频列表，包括标题、播放量、点赞数等信息。
>
> 内容推荐模块应该与其他模块尽可能地解耦合，以确保模块的独立性和可维护性。例如，内容推荐模块应该专注于根据用户的兴趣和当前视频信息推荐相关的视频，而不需要过多涉及用户管理或视频上传等其他功能。



#### 3.5 消息通知模块

> **模块编号：m5**
>
> **输入：**
>
> 1. 系统事件（如新视频上线、评论回复等）
> 2. 用户ID（用于发送私信消息）
>
> **处理：**
>
> 1. 发送系统通知给用户，包括新视频上线、评论回复等。
> 2. 用户之间可以发送私信消息。
>
> **算法描述：**
>
> 1. 监听系统事件，如新视频上线、评论回复等。
> 2. 根据事件类型和相关用户信息，发送相应的系统通知。
> 3. 接收用户发送的私信消息，并将消息存储到数据库中。
>
> **输出：**
>
> 1. 系统通知给用户的消息。
> 2. 用户之间发送的私信消息。

#### 3.6 数据统计与分析模块

> **模块编号：m6**
>
> **输入：**
>
> 1. 用户行为数据（观看时长、点赞次数等）
> 2. 视频播放量数据
> 3. 用户偏好数据
>
> **处理：**
>
> 1. 对用户行为数据进行统计和分析，包括观看时长、点赞次数等。
> 2. 对视频播放量数据进行统计和分析。
> 3. 对用户偏好数据进行分析，从而进行个性化推荐。
>
> **算法描述：**
>
> 1. 统计用户行为数据，如观看时长、点赞次数等，并计算相应的指标。
> 2. 分析视频播放量数据，识别热门视频和潜力视频。
> 3. 分析用户偏好数据，如历史观看记录、点赞记录等，从而推测用户的兴趣爱好。
>
> **输出：**
>
> 1. 用户行为统计报表，包括观看时长、点赞次数等指标。
> 2. 视频播放量统计报表，包括热门视频和潜力视频。
> 3. 用户偏好分析报表，用于个性化推荐。

#### 3.7 管理后台模块

> **模块编号：m7**
>
> **输入：**
>
> 1. 视频管理请求（上传审核、删除、封禁等）
> 2. 用户管理请求（权限设置、封禁用户等）
> 3. 数据统计与分析请求
>
> **处理：**
>
> 1. 处理视频管理请求，包括上传审核、删除、封禁等操作。
> 2. 处理用户管理请求，包括权限设置、封禁用户等操作。
> 3. 处理数据统计与分析请求，生成相应的报表。
>
> **算法描述：**
>
> 1. 根据视频管理请求，对上传的视频进行审核、删除或封禁等操作。
> 2. 根据用户管理请求，对用户的权限进行设置或封禁用户账号。
> 3. 根据数据统计与分析请求，生成相应
> 4. 的报表，并提供给管理员查看。
>
> **输出：**
>
> 1. 视频管理操作结果的提示信息。
> 2. 用户管理操作结果的提示信息。
> 3. 数据统计与分析报表。



## 4 界面设计

### 4.1 外部界面设计

> 1. **主页设计**
>    1. 主页上方左侧为搜索栏，右侧为个人页面入口；
>    2. 主页中部为各分区入口；
>    3. 主页下方左侧为视频滚动推荐窗口，右侧为推荐视频入口。
> 2. **用户个人信息页面设计**
>    1. 页面上方显示用户的ID与名称；
>    2. 页面下方左侧显示用户投稿的视频，右侧显示出生日期等其他个人信息。
> 3. **视频播放页面设计**
>    1. 页面左侧为视频播放界面，右侧为视频投稿者信息；
>    2. 页面下方左侧为评论界面，右侧为其他推荐视频。

### 4.2 内部界面设计

> 1. 主页调用用户个人信息页面和视频页面；
> 2. 视频页面嵌套调用其他视频页面，也调用信息页面；
> 3. 所有页面包含对主页的调用。

### 4.3 用户界面设计

> 1. 用户信息以结构体数组形式存储，对于登录的用户，将其个人信息从数据库中调出，根据登录顺序存放至结构体数组中，若登录人数已达到数组容量则提示“当前在线人数已达上限，请稍等”；
> 2. 视频信息以结构体形式存储，每个视频内部的评论以链表形式存储；
> 3. 当一个页面被打开时（主页或视频播放页面），系统提前将此页面在之后可能被打开的所有视频的信息从数据库中调出并放入结构体中，做视频被打开的准备；
> 4. 当一个视频页面被打开时，系统将页面中各位置所需的信息指向相应的视频结构体；
> 5. 当有新用户注册或有新视频发表时，调用空闲用户或视频结构体，将新注册并新发表的信息填入结构体，并存储至数据库中。



## 5 异常处理设计

*描述各种可能出现的错误和异常情况，并提供相应的处理方法和策略。*

### 5.1 出错信息管理
- error 事件
    当HTML5视频播放过程中发生错误时，浏览器会触发不同的错误事件。通过注册这些错误事件的监听器来捕获错误并进行相应处理。例如，可以监听 error 事件来处理加载视频文件失败、解码失败或其他类型的错误。
```javascript
var video = document.querySelector('video');
video.addEventListener('error', function(event) {
    console.log('发生错误:', event.target.error);
});
```
- loadstart 事件
    在开始加载视频时触发，可以用于显示加载状态的提示，告知用户视频正在加载中。
```javascript
video.addEventListener('loadstart', function(event) {
    console.log('视频加载中...');
});
```
- canplay 和 canplaythrough 事件
    canplay 事件会在视频可以开始播放时触发，而 canplaythrough 事件会在视频能够不间断地播放完毕时触发。利用这两个事件，我们可以在视频准备好播放时给用户提供更好的反馈。
```javascript
video.addEventListener('canplay', function(event) {
    console.log('视频可以开始播放了!');
});
video.addEventListener('canplaythrough', function(event) {
    console.log('视频可以连续播放完毕!');
});
```
- abort 和 stalled 事件
    abort 事件会在视频加载被中止时触发，而 stalled 事件会在视频加载过程中出现问题时触发。这两个事件的触发可以提示用户视频加载失败或加载速度过慢。
- 其他事件
    如视频格式不支持、未知错误等。
### 5.2故障预防与补救
- 补救
数据库连接失败、页面加载缓慢等：分析系统日志、查看服务器状态以及检查数据库连接，以定位故障原因。通过有针对性的解决方法，可以提高系统的可靠性和稳定性。
系统升级或新功能上线时的故障：在这些情况下，兼容性问题和代码错误可能会出现：仔细测试和验证每一步操作，确保系统的稳定性和正常运行。
- 预防
合理设计数据库表结构和索引，优化数据库查询性能。
定期进行系统监控和性能调优，及时修复潜在问题，降低故障发生的概率。
### 5.3 系统维护设计
- 安全性维护
    数据备份：定期备份网站数据，以防止数据丢失。
    安全补丁和防火墙：定期更新和升级网站的安全补丁和防火墙，以确保网站免受恶意攻击。
    访问控制和权限管理：限制对敏感数据和功能的访问，确保只有授权用户可以进行操作。
    加密传输：使用HTTPS协议来加密数据传输，保护用户隐私。
    
- 性能优化
    压缩CSS、JavaScript和HTML文件，减小文件大小，加快页面加载速度。
    
- 定期更新
    功能扩展：根据用户需求和市场趋势，不断扩展网站功能，提供更好的用户体验。
    设计优化：定期审查网站设计，优化用户界面和交互，提高用户满意度。
    
    


## 6 性能优化和安全设计

> 1. **数据存储优化**
>    - 目标：确保数据存储的效率和稳定性，同时考虑成本。
>    - 措施：
>      - 选择合适的数据库：根据项目规模，选择MySQL数据库。
>      - 索引优化：为数据库中频繁查询的字段创建索引，这样可以加快查询速度，提高用户体验。
>      - 定期清理：定期删除不必要的数据，保持数据库的轻量化。
> 2. **数据传输优化**
>    - 目标：确保数据传输的安全和效率。
>    - 措施：
>      - 使用HTTPS：确保所有数据传输都通过HTTPS进行，保障数据安全。
>      - 压缩数据：在服务器端启用GZIP压缩，减少传输数据的大小，加快加载速度。
> 3. **数据访问优化**
>    - 目标：提供快速的数据访问体验。
>    - 措施：
>      - 缓存机制：对于频繁访问的数据使用缓存，如使用浏览器缓存。
>      - 查询优化：确保SQL查询尽可能高效，尽量使用简单的查询语句，并确保数据库表结构合理，避免复杂的联表查询。
> 4. **安全性设计**
>    - 目标：保护网站免受网络攻击，保障用户数据安全。
>    - 措施：
>      - 输入验证：确保所有用户输入都经过验证，防止注入攻击。
>      - 错误处理：正确处理错误，对外只显示通用错误提示，不向用户显示敏感信息。
> 5. **性能监控**
>    - 目标：监控网站性能，及时发现问题。
>    - 措施：
>      - 性能监控工具：使用开源工具，如Nagios或Zabbix，来监控服务器和应用程序的性能。
>      - 日志记录：确保所有关键操作都有日志记录，方便问题追踪和调试。
> 6. **安全备份**
>    - 目标：确保数据的安全备份，以防数据丢失。
>    - 措施：
>      - 定期备份：设置自动备份脚本，定期备份数据库到安全的位置。
>      - 恢复策略：制定明确的数据恢复流程，确保在数据丢失时能够快速恢复。

## 7 项目测试计划

| 序号 |  测试类型  |      对应部分      |                           测试内容                           | 计划测试时间 |
| :--: | :--------: | :----------------: | :----------------------------------------------------------: | :----------: |
|  1   |  单元测试  |    用户账户管理    |  测试用户注册、登录功能的正确性，包括输入验证和错误消息提示  |    第3周     |
|  2   |  单元测试  |   视频上传与处理   |      测试视频文件的上传功能，包括文件大小限制和格式支持      |    第4周     |
|  3   |  单元测试  |      评论系统      |       测试用户发表评论的功能，以及评论的编辑和删除权限       |    第5周     |
|  4   |  集成测试  | 用户界面与视频管理 | 测试用户上传视频后在个人主页的显示，以及视频信息的更新和删除 |    第6周     |
|  5   |  集成测试  |   视频播放与互动   |     测试视频播放功能，包括播放控制和用户间的互动评论功能     |    第6周     |
|  6   |  系统测试  |      全站功能      |      测试网站所有功能的协同工作，确保整个系统按预期运行      |    第7周     |
|  7   |  性能测试  |   页面响应与加载   |  测试网站各页面的加载速度，以及在多用户同时访问时的响应时间  |    第8周     |
|  8   |  安全测试  | 用户数据与隐私保护 |       测试用户数据的加密存储，以及个人隐私设置的有效性       |    第8周     |
|  9   | 可用性测试 |      用户体验      |   测试网站的导航流程，确保用户能够轻松地找到并使用各项功能   |    第9周     |

> *计划测试时间为项目开启后的第n周，并非教学周第n周*
>
> **测试说明**：
>
> - **单元测试**：从项目开始的第一周起，针对每个独立功能进行测试。
> - **集成测试**：在单元测试完成后，测试不同功能模块之间的交互。
> - **系统测试**：在所有模块集成后，测试整个系统的功能。
> - **性能测试**：在项目后期，评估网站的响应速度和处理能力。
> - **安全测试**：在项目接近完成时，检查系统的数据保护机制。
> - **可用性测试**：在最后两周，确保网站的用户界面友好，功能易于访问和使用。
> - **负载测试**：在项目最后一周，模拟高用户负载，测试服务器的承载能力和稳定性。

## 
